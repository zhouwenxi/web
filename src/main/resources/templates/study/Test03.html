<!doctype html>
<html>
<meta charset="utf-8"/>
<script src="jquery-1.8.3.min.js"></script>
<script src="html2canvas.js"></script>

<style>

    #water-text {
        width: 100px;
        height: 30px;
        line-height: 30px;
        color: #ff0000;
        position: absolute;
        cursor: pointer;
    }

</style>


<body>
<div id=content
     style="width:600px;height:600px;border:1px lightblue solid;background-image: url('bg.jpg');background-repeat: no-repeat; ">

    <span id="water-text" onmousedown="small_down(event)">Hello world</span>

</div>

<div class="input-group"><span class="input-group-addon">水印文字</span>
    <input id="words" value="QiShui" class="form-control" maxlength="16" oninput="setwateName()">
</div>

<button id="Save">Save</button>


<script>

    // 设置名字
    function setwateName() {
        document.getElementById("water-text").innerHTML = document.getElementById("words").value;
    }

    //移动处理
    function small_down(e) {
        var obig = document.getElementById("water-wrap");
        var osmall = document.getElementById("water-text");
        var e = e || window.event;
        /*用于保存小的div拖拽前的坐标*/
        osmall.startX = e.clientX - osmall.offsetLeft;
        osmall.startY = e.clientY - osmall.offsetTop;
        /*鼠标的移动事件*/
        document.onmousemove = function (e) {
            var e = e || window.event;
            osmall.style.left = e.clientX - osmall.startX + "px";
            osmall.style.top = e.clientY - osmall.startY + "px";
            /*对于大的DIV四个边界的判断*/
            if (e.clientX - osmall.startX <= 0) {
                osmall.style.left = 0 + "px";
            }
            if (e.clientY - osmall.startY <= 0) {
                osmall.style.top = 0 + "px";
            }
            if (e.clientX - osmall.startX >= 530) {
                osmall.style.left = 530 + "px";
            }
            if (e.clientY - osmall.startY >= 570) {
                osmall.style.top = 570 + "px";
            }
        };
        /*鼠标的抬起事件,终止拖动*/
        document.onmouseup = function () {
            document.onmousemove = null;
            document.onmouseup = null;
        };
    }

    $(function () {
        $("#Save").click(function () {
            html2canvas($("#content"), {

                onrendered: function (canvas) {
                    //document.body.appendChild(canvas);

                    var a = document.createElement('a');
                    a.download = '我是文件名.jpg';
                    a.href = canvas.toDataURL("image/jpeg");
                    a.click();

                }

            });
        });
    });

</script>
</body>
</html>